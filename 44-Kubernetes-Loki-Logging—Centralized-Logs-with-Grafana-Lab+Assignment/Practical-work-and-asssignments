# ðŸš€ Loki for Logging â€” Practical Work & Assignment

### ðŸ§° Practical Work Steps

**Step 1: Launch EC2 Server**

* OS: Ubuntu 22.04 LTS
* Instance Type: t2.medium (2 vCPU, 4 GB RAM)
* Open Ports: 22 (SSH), 3000 (Grafana UI), 3100 (Loki UI optional)
  *Roman Urdu:* Naya server launch karte hain aur ports open karte hain taake access ho.

---

**Step 2: Install Docker + Kubernetes**

```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y apt-transport-https ca-certificates curl gnupg lsb-release software-properties-common
sudo apt install -y docker.io containerd
sudo systemctl enable docker
sudo systemctl start docker

sudo mkdir -p /etc/containerd
containerd config default | sudo tee /etc/containerd/config.toml
sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml
sudo systemctl restart containerd
sudo systemctl enable containerd

sudo swapoff -a
sudo sed -i '/ swap / s/^/#/' /etc/fstab
sudo modprobe overlay
sudo modprobe br_netfilter

cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
EOF

sudo sysctl --system
```

*Roman Urdu:* Docker aur container runtime install karte hain, system configs set karte hain aur swap off karte hain.

**Install Kubernetes:**

```bash
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list
sudo apt update
sudo apt install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
```

*Roman Urdu:* Kubernetes components install karte hain aur hold kar dete hain taake update na ho.

---

**Step 3: Initialize Kubernetes Cluster**

```bash
sudo kubeadm init --pod-network-cidr=192.168.0.0/16
```

*Roman Urdu:* Cluster initialize hota hai aur join command + kubeconfig milegi.

---

**Step 4: Configure kubectl**

```bash
mkdir -p $HOME/.kube
sudo cp /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

*Roman Urdu:* Kubectl configure karte hain taake current user cluster use kar sake.

---

**Step 5: Install Calico CNI**

```bash
kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml
```

*Roman Urdu:* Networking ke liye Calico install karte hain.

---

**Step 6: Install Helm**

```bash
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
helm version
```

*Roman Urdu:* Helm install karte hain taake charts deploy kar saken.

---

**Step 7: Deploy Loki Stack via Helm**

**7.1 Add Helm Repo**

```bash
helm repo add grafana https://grafana.github.io/helm-charts
helm repo update
```

*Roman Urdu:* Grafana ke charts add aur update karte hain.

**7.2 Remove Control Plane Taint (single node)**

```bash
kubectl taint nodes --all node-role.kubernetes.io/control-plane-
```

*Roman Urdu:* Single node cluster mein pods control plane pe run kar sake.

**7.3 Create Logging Namespace**

```bash
kubectl create namespace logging
```

*Roman Urdu:* Logging components ke liye alag namespace.

**7.4 Install Loki Stack**

```bash
helm install loki-stack grafana/loki-stack \
  --namespace=logging \
  --set grafana.enabled=true \
  --set prometheus.enabled=false \
  --set loki.persistence.enabled=false \
  --set fluent-bit.enabled=false \
  --set promtail.enabled=true \
  --wait \
  --timeout 10m
```

*Roman Urdu:* Loki + Promtail + Grafana deploy hota hai. Logs collect aur dashboard ready hota hai.

---

**Step 8: Check Pods**

```bash
kubectl get pods -n logging
```

*Roman Urdu:* Ensure karo Loki, Promtail aur Grafana pods running hain.

---

**Step 9: Access Grafana (Port Forward)**

```bash
kubectl port-forward svc/loki-stack-grafana 3000:80 -n logging
```

*Roman Urdu:* Browser mein `http://localhost:3000` open karo.

---

**Step 10: Login to Grafana**

```bash
kubectl get secret --namespace logging loki-stack-grafana -o jsonpath="{.data.admin-password}" | base64 -d
```

*Roman Urdu:* Default username/password use karke login karo.

---

**Step 11: View Logs in Grafana**

1. Explore tab open karo
2. Source: Loki select karo
3. Query examples:

```text
{job=~".+"}
{job="kubernetes-pods"}
{pod=~".*nginx.*"}
```

*Roman Urdu:* Real-time logs dekh sakte ho aur filter kar sakte ho.

---

### âœ… Assignment

1. Login to Grafana (`http://localhost:3000`)
2. Go to â€œExploreâ€ tab
3. Filter logs using:

* `{job="kubernetes-pods"}`
* `{pod=~".*calico.*"}`
* `{container=~".*coredns.*"}`

4. Screenshot save karo
5. ðŸ”¥ Bonus: Grafana alert create karo agar logs mein `level=error` ho

---

