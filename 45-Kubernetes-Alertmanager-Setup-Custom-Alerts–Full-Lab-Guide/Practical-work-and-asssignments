ðŸš¨ Alertmanager â€“ Practical Work & Assignment
________________________________________
ðŸŸ¢ Step 1: Launch EC2 Server
â€¢ Ubuntu 22.04 LTS, t2.medium
â€¢ Security Group me open ports: 22 (SSH), 3000 (Grafana), 9090 (Prometheus), 9093 (Alertmanager)
â€¢ Description: Naya server ready karo for Kubernetes + monitoring setup

ðŸŸ¢ Step 2: Install Docker + Kubernetes
sudo apt update && sudo apt upgrade -y
sudo apt install -y apt-transport-https ca-certificates curl gnupg lsb-release software-properties-common
sudo apt install -y docker.io containerd
sudo systemctl enable --now docker

# Containerd config
sudo mkdir -p /etc/containerd
containerd config default | sudo tee /etc/containerd/config.toml
sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml
sudo systemctl restart containerd
sudo systemctl enable containerd

# System config for Kubernetes
sudo swapoff -a
sudo sed -i '/ swap / s/^/#/' /etc/fstab
sudo modprobe overlay
sudo modprobe br_netfilter

cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
EOF

sudo sysctl --system
â€¢ Description: Docker aur Kubernetes dependencies install kar ke node ready karna

ðŸŸ¢ Step 3: Install Kubeadm, Kubelet, Kubectl
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list
sudo apt update
sudo apt install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
â€¢ Description: Kubernetes tools install karna

ðŸŸ¢ Step 4: Initialize Kubernetes Cluster
sudo kubeadm init --pod-network-cidr=192.168.0.0/16
â€¢ Description: Single node cluster setup karo, join command save karo future nodes ke liye

ðŸŸ¢ Step 5: Configure kubectl
mkdir -p $HOME/.kube
sudo cp /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
â€¢ Description: Local kubectl configure karo

ðŸŸ¢ Step 6: Install Calico CNI
kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml
â€¢ Description: Networking enable karne ke liye Calico apply karo

ðŸŸ¢ Step 7: Install Helm
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
helm version
â€¢ Description: Helm install karke chart deploy ke liye ready karo

ðŸŸ¢ Step 8: Remove Control Plane Taint
kubectl taint nodes --all node-role.kubernetes.io/control-plane-
â€¢ Description: Single node cluster me control plane pe workload allow karna

ðŸŸ¢ Step 9: Install Prometheus + Alertmanager Stack
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
kubectl create namespace monitoring
helm install prometheus prometheus-community/kube-prometheus-stack \
  --namespace monitoring \
  --set alertmanager.persistentVolume.enabled=false \
  --set grafana.enabled=true \
  --set prometheus.prometheusSpec.serviceMonitorSelectorNilUsesHelmValues=false \
  --wait \
  --timeout 10m
â€¢ Description: Monitoring stack install karo (Prometheus + Alertmanager + Grafana + Node Exporters)

ðŸŸ¢ Step 10: Verify Pods
kubectl get pods -n monitoring
â€¢ Description: Pods running check karo

ðŸŸ¢ Step 11: Access Grafana
kubectl port-forward svc/prometheus-grafana -n monitoring 3000:80
Open browser: http://localhost:3000
â€¢ Description: Grafana UI access karo

ðŸŸ¢ Step 12: Grafana Login
kubectl get secret --namespace monitoring prometheus-grafana -o jsonpath="{.data.admin-password}" | base64 -d
Username: admin, Password: from output
â€¢ Description: Login credentials le lo

ðŸŸ¢ Step 13: Create & Apply Custom Alert
nano high-cpu-alert-rule.yaml
# Paste PrometheusRule config
kubectl apply -f high-cpu-alert-rule.yaml
kubectl get prometheusrule -n monitoring
â€¢ Description: High CPU usage alert create aur apply karo, dashboard me verify karo

ðŸŸ¢ Step 14: Configure Alertmanager Email
nano alertmanager.yaml
# Paste email config with Gmail app password
kubectl -n monitoring delete secret alertmanager-prometheus-kube-prometheus-alertmanager
kubectl -n monitoring create secret generic alertmanager-prometheus-kube-prometheus-alertmanager --from-file=alertmanager.yaml
kubectl -n monitoring delete pod -l app.kubernetes.io/name=alertmanager
â€¢ Description: Email alerts ke liye Alertmanager configure karo aur pod restart

ðŸŸ¢ Step 15: Trigger & Verify Alerts
sudo apt install stress-ng -y
stress-ng --cpu 4 --timeout 5m
â€¢ Description: CPU stress generate karo, Prometheus dashboard me alert firing check karo aur email receive karo

ðŸ“ Assignment:
â€¢ Configure working alerts in Prometheus & Alertmanager
â€¢ Trigger alerts using stress-ng
â€¢ Verify email notifications received successfully
________________________________________
