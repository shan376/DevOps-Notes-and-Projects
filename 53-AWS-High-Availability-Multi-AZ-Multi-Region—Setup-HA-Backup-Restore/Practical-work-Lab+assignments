# Practical Work + Assignments â€” AWS High Availability (HA) Multi-AZ Setup

Practical Work

### Step 1 â€” Create Custom VPC

* **Purpose:** Apni network isolate aur manage karne ke liye custom VPC.
* **Commands/Steps:**

  * AWS Console â†’ VPC â†’ Create VPC
  * Name: `ha-prod-vpc`
  * CIDR: `10.0.0.0/16`
  * Tenancy: Default â†’ Create

---

### Step 2 â€” Create Subnets (Multi-AZ)

* **Purpose:** Multi-AZ setup ke liye public + private subnets.
* **Subnets Table:**

  * Public-Subnet-A â†’ 10.0.1.0/24 â†’ us-east-1a
  * Public-Subnet-B â†’ 10.0.2.0/24 â†’ us-east-1b
  * Private-Subnet-A â†’ 10.0.3.0/24 â†’ us-east-1a
  * Private-Subnet-B â†’ 10.0.4.0/24 â†’ us-east-1b

---

### Step 3 â€” Internet Gateway (IGW)

* **Purpose:** Public subnet internet access ke liye.
* **Steps:**

  * VPC â†’ Internet Gateways â†’ Create IGW
  * Name: `ha-igw` â†’ Attach to `ha-prod-vpc`

---

### Step 4 â€” Route Tables

* **Public RT:**

  * Destination: `0.0.0.0/0` â†’ Target: `ha-igw`
  * Subnet associations â†’ Public-Subnet-A + Public-Subnet-B
* **Private RT:**

  * No internet route yet
  * Subnet associations â†’ Private-Subnet-A + Private-Subnet-B

---

### Step 5 â€” NAT Gateway (Private Internet)

* **Purpose:** Private EC2 internet access (updates/Apache install).
* **Steps:**

  * Elastic IP â†’ Allocate new â†’ `nat-eip`
  * NAT Gateway â†’ Subnet: Public-Subnet-A â†’ Elastic IP: `nat-eip`
  * Private RT â†’ Add route: `0.0.0.0/0` â†’ Target: NAT Gateway

---

### Step 6 â€” Security Groups

* **Bastion-SG (Public EC2):**

  * Inbound: SSH 22 â†’ My IP
  * Outbound: All traffic â†’ 0.0.0.0/0
* **Private-EC2-SG (Private EC2):**

  * Inbound: SSH 22 â†’ Source: Bastion-SG
  * Outbound: All traffic â†’ 0.0.0.0/0

---

### Step 7 â€” Launch Public EC2 (Bastion)

* AMI: Ubuntu 24.04 LTS
* Instance Type: t2.micro
* Subnet: Public-Subnet-A
* Auto-assign Public IP: Enable
* SG: Bastion-SG
* Key Pair: `bastion-key.pem`

---

### Step 8 â€” Launch Private EC2 (AZ-A + AZ-B)

* **Instance 1:** Private-Subnet-A â†’ Auto-assign Public IP: Disable â†’ SG: Private-EC2-SG â†’ Key: bastion.pem
* **Instance 2:** Private-Subnet-B â†’ Same as above

---

### Step 9 â€” SSH & Apache Installation

**Bastion â†’ Private EC2 (AZ-A):**

```bash
ssh -i ~/Downloads/bastion.pem ubuntu@<Bastion-Public-IP>
chmod 400 /home/ubuntu/bastion.pem
ssh -i /home/ubuntu/bastion.pem ubuntu@<Private-EC2-A-IP>

sudo apt update -y
sudo apt install apache2 -y
echo "Hello from Private EC2 (AZ-A)" | sudo tee /var/www/html/index.html
systemctl status apache2
curl localhost
```

**Bastion â†’ Private EC2 (AZ-B):**

* Same steps as above, replace message: `"Hello from Private EC2 (AZ-B)"`

---

### Step 10 â€” Auto Scaling Setup

**Launch Template:**

* Name: `Launch1a.s`
* AMI: Ubuntu 24.04 LTS
* Instance Type: t3.micro
* SG: Private-EC2-SG
* Key: bastion.pem
* User data: Apache install aur welcome page

**Auto Scaling Group:**

* Name: `private-ec2-asg`
* Launch Template: `Launch1a.s`
* VPC: ha-prod-vpc
* Subnets: Private-Subnet-A + Private-Subnet-B
* Desired: 2, Min:1, Max:4
* Attach to Target Group: `private-ec2-tg`

---

### Step 11 â€” Application Load Balancer (ALB)

* **Create ALB:** Internet-facing, HTTP 80, Subnets: Public-Subnet-A + B, SG: mynewsg
* **Create Target Group:** `private-ec2-tg`, Protocol: HTTP 80 â†’ Add both private EC2s
* Health Check: `/` â†’ Success codes 200

---

### Step 12 â€” Verify Multi-AZ HA & ALB

* **Bastion â†’ Private EC2:** `curl localhost` â†’ AZ-A / AZ-B response
* **Browser â†’ ALB DNS:** Round-robin responses between AZ-A & AZ-B
* **Auto Scaling Test:** Terminate one private EC2 â†’ New instance auto-launch â†’ ALB still serves traffic

---

### âœ… Key Takeaways

* Multi-AZ: AZ-A + AZ-B for HA
* ALB: Traffic distribution
* Auto Scaling: Load & failure handling
* Private EC2: Internet via NAT
* Bastion: Secure SSH access
* Apache installed & accessible

---
# Assignment â€” Backup & Restore Plan (AWS Multi-AZ)

### Step 1 â€” Create AMI Backup (Instance Image)

* **Purpose:** Full instance (OS + Apache + configs) backup for disaster recovery.
* **Commands/Steps:**

  1. AWS Console â†’ EC2 â†’ Instances
  2. Select Private EC2 AZ-A â†’ Actions â†’ Image â†’ Create Image
  3. Name: `Private-EC2-AZ-A-Backup`
  4. Optional: No reboot â†’ Check agar downtime avoid karna ho
  5. Repeat for: Private EC2 AZ-B + Bastion Public EC2
  6. Verify â†’ EC2 â†’ AMIs â†’ backup images ready

---

### Step 2 â€” Create EBS Snapshot (Volume Backup)

* **Purpose:** Disk-level data safe, recover volume if corrupt.
* **Steps/Commands:**

  1. EC2 â†’ Volumes â†’ Select Private EC2 AZ-A root volume
  2. Actions â†’ Create Snapshot â†’ Name: `Private-EC2-AZ-A-Snapshot`
  3. Repeat for Private EC2 AZ-B + Bastion
  4. Verify â†’ EC2 â†’ Snapshots â†’ available

---

### Step 3 â€” Application Data Backup to S3

* **Purpose:** Website/app files safe in durable S3 bucket.
* **Steps:**

  * **Part 1 â€” Create S3 Bucket:**

    ```
    Bucket name: ha-assignment-backup  
    Region: us-east-1  
    Block Public Access: ON  
    Optional: Enable versioning
    ```
  * **Part 2 â€” IAM Role for EC2:**

    * Create custom policy `S3BackupWritePolicy` (least privilege)
    * Create IAM Role `EC2-S3-Backup-Role` â†’ Attach policy
    * Attach role to private EC2 / ASG Launch Template
  * **Part 3 â€” Optional S3 VPC Endpoint:**

    * VPC â†’ Endpoints â†’ Create â†’ Service: S3 â†’ private-rt route table
  * **Part 4 â€” Install AWS CLI v2 on Private EC2:**

    ```bash
    sudo apt update -y
    sudo apt install -y unzip curl
    curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
    unzip awscliv2.zip
    sudo ./aws/install
    aws --version
    ```
  * **Part 5 â€” Verify Role/credentials:**

    ```bash
    aws sts get-caller-identity
    export AWS_REGION=us-east-1
    ```
  * **Part 6 â€” First Sync to S3:**

    ```bash
    aws s3 sync /var/www/html s3://ha-assignment-backup/ --dryrun --region us-east-1
    aws s3 sync /var/www/html s3://ha-assignment-backup/ --region us-east-1
    aws s3 ls s3://ha-assignment-backup/ --region us-east-1
    ```

---

### Step 4 â€” Automated Backup (Lifecycle Manager) **Optional**

* **Purpose:** Automatic EBS snapshots, no manual backup needed.
* **Steps:**

  1. AWS Console â†’ EC2 â†’ Lifecycle Manager â†’ Create Policy
  2. Policy Type: EBS Snapshot â†’ Target Volumes: Private EC2 AZ-A/B + Bastion
  3. Schedule: Daily / Weekly â†’ Retention: e.g., 7 snapshots
  4. Create Policy â†’ Automatic snapshots ready

---

### Step 5 â€” Restore Plan

**Purpose:** Restore data/app if EC2 crash ya delete ho jaye.

* **Option 1 â€” Restore from AMI (Full EC2):**

  1. EC2 â†’ AMIs â†’ Select backup â†’ Launch Instance
  2. VPC: ha-prod-vpc â†’ Subnet: AZ-A/B â†’ SG: Private-EC2-SG
  3. Connect via Bastion (if private)
  4. Verify Apache & website:

  ```bash
  curl localhost
  # Output: Hello from Private EC2 (AZ-A/B)
  ```
* **Option 2 â€” Restore EBS Snapshot:**

  1. EC2 â†’ Snapshots â†’ Create Volume â†’ AZ
  2. Attach volume â†’ SSH via Bastion â†’ Check:

  ```bash
  lsblk
  sudo mkdir /mnt/restore
  sudo mount /dev/xvdf /mnt/restore
  sudo cp -r /mnt/restore/* /var/www/html/
  curl localhost
  ```
* **Option 3 â€” Restore from S3 (Primary Recommended):**

  ```bash
  aws s3 sync s3://ha-assignment-backup/ /var/www/html/
  curl localhost
  ```

---

### Step 6 â€” Test Backup & Restore (Practical)

1. Terminate Private EC2 AZ-A â†’ AWS Console â†’ EC2 â†’ Terminate â†’ Confirm
2. Launch New Instance using AMI â†’ Verify Apache & website
3. Launch using EBS Snapshot (optional) â†’ Mount & copy files â†’ Verify
4. Verify ALB & Auto Scaling â†’ Browser â†’ ALB DNS â†’ Round-robin responses:

   ```
   Hello from Private EC2 (AZ-A)
   Hello from Private EC2 (AZ-B)
   ```

âœ… Result: Backup & restore kaam kar raha, HA setup verified

---

### ðŸ”‘ Key Takeaways

* Backup: AMI (full), EBS Snapshot (volume), S3 (app files)
* Restore: AMI / EBS / S3 â†’ Fast & production-ready
* Multi-AZ: HA ensured
* ALB & Auto Scaling: Load distribute & failover verified
* IAM Roles + Lifecycle Manager â†’ Security + automation

---

