üìò AWS IAM Advanced Concepts ‚Äî Roles, Policies & Federation

1Ô∏è. IAM Roles

Definition:

AWS IAM role ek temporary identity hai jo specific permissions ke saath assign hoti hai. Ye user ya service ko short-term access deti hai bina permanent credentials share kiye.
Zarurat:
‚Ä¢	Jab aap chahte ho ke EC2 instances, Lambda functions, ya dusre AWS accounts ke users temporary access le sakein.
‚Ä¢	Security improve hoti hai kyunki long-term keys share nahi hoti.
Real-Life Example:
‚Ä¢	Tumhara startup hai, aur tumhare paas ek EC2 server hai jo S3 bucket me data read karna chahta hai.
‚Ä¢	EC2 instance ko direct AWS keys dena risky hai. Tum Role attach kar dete ho EC2 ko aur automatically wo bucket access kar sakta hai.
‚Ä¢	Agar keys leak ho bhi jaye, koi problem nahi, kyunki ye temporary credentials hai.
Key Points:
‚Ä¢	Roles ko assume kiya jata hai.
‚Ä¢	Temporary credentials hamesha expire ho jate hain.
‚Ä¢	Least privilege principle ke liye best practice.

---

2Ô∏è. IAM Policies
Definition:
Policy ek JSON document hai jo define karta hai ke user, role, ya group ko AWS resources pe kya actions perform karne ki permission hai.
Zarorat:
‚Ä¢	Security enforce karne ke liye.
‚Ä¢	Access control simple aur manageable banata hai.
‚Ä¢	Granular control: kaun GET, PUT, LIST ya DELETE kar sakta hai.
Types:

1. Managed Policies: AWS ne pre-defined banayi hui, easy attach karna.
2. Inline Policies: Custom policies, specific user ya role ke liye.
   Real-Life Example:
   ‚Ä¢	Tumhare paas S3 bucket hai jisme sensitive data hai.
   ‚Ä¢	Policy define karte ho: Sirf Finance team read kar sakti hai, Dev team sirf upload kar sakti hai.
   ‚Ä¢	Agar koi aur try kare to AccessDenied aayega.
   Key Points:
   ‚Ä¢	JSON format me likhi jati hai.
   ‚Ä¢	Action, Resource, Effect (Allow/Deny) specify karna hota hai.
   ‚Ä¢	Least privilege follow karna security ke liye zaruri.

---

3Ô∏è. Federation
Definition:
Federation matlab external identities (jaise corporate Active Directory ya Google workspace users) ko AWS resources access karna allow karna without creating IAM users.
Zarurat:
‚Ä¢	Agar tumhare organization me already users exist karte hain (AD, SSO), unko AWS credentials bina banaye access dena.
‚Ä¢	Centralized identity management.
Real-Life Example:
‚Ä¢	Tumhari company ke employees Google Workspace ya Microsoft AD use karte hain.
‚Ä¢	Har employee ke liye AWS IAM user create karna boring aur error-prone hai.
‚Ä¢	Federation setup karte ho: Employees apne corporate login se AWS console ya CLI access kar sakte hain.
‚Ä¢	Security improve hoti hai, keys create nahi karne padti.
Key Points:
‚Ä¢	Temporary access hota hai.
‚Ä¢	SAML 2.0 ya OIDC standard use hota hai.
‚Ä¢	Corporate identity ko AWS me extend karna easy.

---

üîëSummary
‚Ä¢	Roles: Temporary identity for EC2/Lambda/Users across accounts.
‚Ä¢	Policies: Define karte hain kaun kya kar sakta hai (granular control).
‚Ä¢	Federation: External users ko AWS access dena without IAM users.

---

Practical Work
Cross Account S3 Access via Role
Goal (Maqsad): Account B ka IAM user/role, Account A ki S3 bucket ko securely access kare ‚Äî assume role ke through (temporary credentials).

---

üß≠ High Level Map ‚Äî Kis Account me kya hoga?
‚Ä¢	Account A (Resource Owner)
o	S3 bucket banani
o	IAM Role banana (trust = Account B)
o	(Optional) Bucket policy fine tune karni
o	Role ka ARN copy karke Account B ko dena
‚Ä¢	Account B (Consumer)
o	IAM user (ya role) banana jisko sts:AssumeRole allow ho
o	AWS CLI configure karna (Account B user keys se)
o	assume-role chalana ‚Üí temporary credentials
o	Temp creds se S3 bucket list/get test karna

---

‚úÖ Pre Flight Checklist
‚Ä¢	2 AWS accounts (A & B) ‚Äî Free Tier ok
‚Ä¢	Region decide: example us east 1 (Consistency bohat important!)

---

üÜî Account IDs & ARNs kahan se milenge?
Console se:
‚Ä¢	Console ke top right ‚Üí apna account name/email ‚Üí Account ID (12 digits)
CLI se (optional):
aws sts get-caller-identity

# Output me "Account": "123456789012"

ARN format reminders:
‚Ä¢	Role ARN: arn:aws:iam::<AccountA-ID>:role/CrossAccountS3ReadRole
‚Ä¢	Account root principal: arn:aws:iam::<AccountB-ID>:root
Note: IDs/ARNs copy karte waqt spaces, extra characters na ayen.

---

üîπ Step 1 ‚Äî Account A me S3 Bucket create karo

1. Login ‚Üí Account A
2. S3 ‚Üí Create bucket
3. Bucket name: account-a-cross-bucket-shan457043(global unique)
4. Region: us-east-1 (ya jo aap ne decide kiya)
5. Block all public access = ON (recommended)
6. Create bucket
   (Optional) Test object upload: Console se bucket me readme.txt upload kar do taa ke list karne par kuch nazar aaye.

---

üîπ Step 2 ‚Äî Account A me Cross Account Role banao

1. IAM ‚Üí Roles ‚Üí Create role
2. Trusted entity type: Another AWS account
3. Account ID: Account B ka 12 digit ID
4. (Optional) External ID enable ‚Äî agar third party scenario imitate karna ho (niche detailed section diya hai)
5. Permissions: AmazonS3ReadOnlyAccess attach
6. Role name: CrossAccountS3ReadRole
7. Create role ‚Üí ho gaya.
8. Role ka ARN copy karo (example): arn:aws:iam::111122223333:role/CrossAccountS3ReadRole
   üîê Trust Relationship (auto + verify)
   Role ‚Üí Trust relationships tab me JSON roughly aisa hona chahiye:
   {
   "Version": "2012-10-17",
   "Statement": [
   {
   "Effect": "Allow",
   "Principal": { "AWS": "arn:aws:iam::<AccountB-ID>:root" },
   "Action": "sts:AssumeRole"
   }
   ]
   }
   Replace <AccountB-ID> with actual 12 digit account B ID.
   Why root principal? Iska matlab Account B ke users/roles is role ko assume kar sakte hain (jab unke paas sts:AssumeRole allow ho).

---

Step 3 ‚Äî Account B me Policy banani + IAM User create karna (CLI use ke liye)

1. Custom Policy Banani
   ‚Ä¢	AWS Console ‚Üí IAM ‚Üí Policies ‚Üí Create policy
   ‚Ä¢	JSON tab select karo aur yeh paste karo:
   {
   "Version": "2012-10-17",
   "Statement": [
   {
   "Effect": "Allow",
   "Action": "sts:AssumeRole",
   "Resource": "arn:aws:iam::<AccountA-ID>:role/CrossAccountS3ReadRole"
   }
   ]
   }
   ‚Ä¢	<AccountA-ID> ko Account A ka actual 12-digit ID se replace karo.
   ‚Ä¢	Next: Tags ‚Üí Next: Review
   ‚Ä¢	Policy name: AllowAssumeCrossAccountS3Role
   ‚Ä¢	Create policy.

---

2. IAM User Create Karna
   ‚Ä¢	IAM ‚Üí Users ‚Üí Add users
   ‚Ä¢	User name: cross-account-tester
   ‚Ä¢	Access key - Programmatic access select karo
   ‚Ä¢	Next: Permissions ‚Üí Attach existing policies directly
   ‚Ä¢	Jo policy tumne pehle banayi thi (AllowAssumeCrossAccountS3Role) usko select karo
   ‚Ä¢	Next ‚Üí Create user
   ‚Ä¢	Access Key ID & Secret Access Key download/store karo (CSV file).

---

üîπ Step 4 ‚Äî Account B par AWS CLI configure
Ubuntu Server Create

# AWS CLI ya Console se EC2 instance launch karen

# Example: Ubuntu 24.04 LTS, t2.micro, us-east-1

# Security group: SSH port 22 open

# Key pair: my-key.pem create/download karo

SSH se connect:

# Local terminal se connect karne ke liye

ssh -i "my-key.pem" ubuntu@<EC2_PUBLIC_IP>
Commands:
sudo apt update -y
sudo apt upgrade -y
curl "[https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip](https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip)" -o "awscliv2.zip"
sudo apt install unzip -y
unzip awscliv2.zip
sudo ./aws/install
aws --version
aws configure
AWS Access Key ID [None]: <Account-B User Access Key>
AWS Secret Access Key [None]: <Account-B User Secret Key>
Default region name [None]: us-east-1
Default output format [None]: json
Ye Account B ke long term user keys hain (sirf assume role chalane ke liye). Data access in keys se direct nahi hoga.

---

üîπ Step 5 ‚Äî Account B se Role Assume karna (temporary creds lena)
aws sts assume-role \
--role-arn arn:aws:iam::<AccountA-ID>:role/CrossAccountS3ReadRole \
--role-session-name CrossAcctS3Test
Output me milega: AccessKeyId, SecretAccessKey, SessionToken, Expiration.

---

üîπ Step 6 ‚Äî Account B Temporary Credentials ko CLI profile me set karo
Option A ‚Äî Named profile (recommended):
aws configure --profile cross-account
AWS Access Key ID: <AccessKeyId from assume-role>
AWS Secret Access Key: <SecretAccessKey from assume-role>
Default region: us-east-1
aws configure set aws_session_token "<SessionToken from assume-role>" --profile cross-account

---

üîπ Step 7 ‚Äî Account B Test: Account A bucket ko list/get karo
aws s3 cp s3://account-a-cross-bucket-shan457043/readme.txt ./ --profile cross-account --region us-east-1
‚úÖ Agar listing/GET chal gaya ‚Üí SUCCESS (Goal achieved)

---

üßπ Clean Up (Free Tier safe raho)
‚Ä¢	Account A: Test bucket delete karo (pehle objects delete)
‚Ä¢	Account A: CrossAccountS3ReadRole delete
‚Ä¢	Account B: cross-account-tester user delete (pehle access key, then user)
‚Ä¢	Local: ~/.aws/credentials me se test profiles/keys remove

---

üèÅ Summary (1 pager)
‚Ä¢	Account A: Bucket + CrossAccountS3ReadRole (trust = Account B root), perms = AmazonS3ReadOnlyAccess
‚Ä¢	Account B: User with policy sts:AssumeRole ‚Üí CLI se assume-role ‚Üí temp creds
‚Ä¢	Test: Temp creds se aws s3 ls/cp (read) on Account A bucket ‚Üí ‚úÖ
‚Ä¢	Security+: Optional bucket policy + External ID = least privilege + strong trust

---

Assignment
Cross Account S3 Access via Role
Objective: Account B ke IAM users aur roles ko secure aur least-privilege read-only access dena Account A ke S3 buckets par, temporary credentials ke through assume-role ka use kar ke.

---

Custom IAM Policies
1Ô∏è. Account B User Policy ‚Äî Assume Role
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": "sts:AssumeRole",
"Resource": "arn:aws:iam::<AccountA-ID>:role/CrossAccountS3ReadRole",
"Condition": {
"StringEquals": {
"sts:ExternalId": "<Optional-External-ID>"
}
}
}
]
}
Explanation:
‚Ä¢	Ye policy Account B ke IAM user ko allow karti hai ke woh Account A ka CrossAccountS3ReadRole role assume kare.
‚Ä¢	sts:ExternalId optional hai lekin agar third-party ya strong trust chahiye to use karna zaroori hai.
‚Ä¢	Ye ensure karta hai ke direct long-term keys se access na ho, sirf temporary creds use hon.

---

2Ô∏è. Account A Role Policy ‚Äî Read-Only S3 Access
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": ["s3:GetObject", "s3:ListBucket"],
"Resource": [
"arn:aws:s3:::account-a-cross-bucket-<unique>",
"arn:aws:s3:::account-a-cross-bucket-<unique>/*"
]
}
]
}
Explanation:
‚Ä¢	Ye role Account A me create hota hai aur Account B ke users ke liye read-only S3 access allow karta hai.
‚Ä¢	Sirf GetObject aur ListBucket actions allow hain, write/upload deny hai.
‚Ä¢	Ye least-privilege principle follow karta hai.

---

3Ô∏è. Optional Bucket Policy ‚Äî Restrict Access to Role Only
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "AllowReadOnlyFromCrossAccountRole",
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<AccountA-ID>:role/CrossAccountS3ReadRole"
},
"Action": ["s3:ListBucket", "s3:GetObject"],
"Resource": [
"arn:aws:s3:::account-a-cross-bucket-<unique>",
"arn:aws:s3:::account-a-cross-bucket-<unique>/*"
]
}
]
}
Explanation:
‚Ä¢	Ye bucket policy ensure karti hai ke sirf CrossAccountS3ReadRole se hi access possible ho.
‚Ä¢	Agar kisi ne keys leak bhi ki, direct access nahi ho payega.
‚Ä¢	Ye extra security layer provide karti hai aur portfolio me professional-level implementation dikhata hai.

---

Summary:
‚Ä¢	Policy 1: Account B ke IAM user ko role assume karne ki permission.
‚Ä¢	Policy 2: Account A ka role Account B ke users ko read-only S3 access deta hai.
‚Ä¢	Policy 3: Optional bucket-level restriction for stronger security.

---
